---
title:  "Assignment_2"
author: "Kris Evers"
date:   "2019-09-23"
output: html_notebook
---

## Scientific Programming | Assignment 2

In this assignment information about the boiling point of simple molecules is requested by running a SPARQL query on the Wikidata database. Alkanes are molecules with only single bonds. It is straightforward to see a relationship between the number of carbon atoms a molecule has and the boiling point. The determination is more complicated than that though. Molecules with the same number of atoms can have different structures. A branched alkane has a different boiling point than a unbranched alkane with the same number of carbon atoms. In this assignment the Partial Least Squares method is used to determine what the best predictor(s) is/are for the measure of boiling point.

### Installing dependencies

In this project multiple R packages are required. The function query_wikidata from the WikiQueryServiceR package is used to parse a query that requests data from the WikiData database. rJava is a dependency of the rcdk package and thus needs to be installed here. The rcdk package (R chemical development kit) is used to parse the SMILES format and receive chemical descriptors which will be used in the PLS process as predictors for the boiling point. The pls library will be used to perform PLS process.

```{r library, echo = FALSE, error=FALSE}
  # install required packages
  install.packages(c("wikidataQueryServiceR", "rJava", "rcdk", "pls", "caTools"))
```

### Wikidata Query Service R

```{r query}
  # load required package
  library(WikidataQueryServiceR)

  # define and request query
  r <- query_wikidata('SELECT ?ane ?aneLabel ?bp ?bpUnit ?bpUnitLabel ?SMILES 
                      WHERE {   ?ane wdt:P31/wdt:P279* wd:Q41581 ;   
                      wdt:P233 ?SMILES ;     
                      p:P2102 [         ps:P2102 ?bp ;           
                      psv:P2102/wikibase:quantityUnit  ?bpUnit         ] .   
                      SERVICE wikibase:label { bd:serviceParam wikibase:language "[AUTO_LANGUAGE],en". } } 
                      ')
```

### Boiling point conversion to kelvin

```{r bp conversion}
  # conversion of boiling point temperatures to degree kelvin
  r$bp[r$bpUnitLabel == "degree Celsius"] <- r$bp[r$bpUnitLabel == "degree Celsius"] + 273.15
  r$bpUnitLabel[r$bpUnitLabel == "degree Celsius"] <- "kelvin"
  r$bp[r$bpUnitLabel == "degree Fahrenheit"] <- (r$bp[r$bpUnitLabel == "degree Fahrenheit"]-32)*5/9 + 273.15
  r$bpUnitLabel[r$bpUnitLabel == "degree Fahrenheit"] <- "kelvin"
```

### Parse SMILES and get descriptor values

```{r smiles}
  # load required packages
  library(rJava)
  library(rcdk)
  library(caTools)
  
  # parsing the smiles column to a IAtomContainer
  parsed_smiles <- parse.smiles(r$SMILES)
  
  # fetching the descriptors per SMILES (i.e. molecule)
  descNames <- c(
  'org.openscience.cdk.qsar.descriptors.molecular.FragmentComplexityDescriptor',
  'org.openscience.cdk.qsar.descriptors.molecular.WienerNumbersDescriptor'
  )
  descs <- eval.desc(parsed_smiles, descNames)
  
  # combine boiling point data and descriptors in one data frame
  data_set <- data.frame(r$bp, descs)
  
  # set percentage of data that goes to the test set and the training set
  percentage <- 0.3
  # set a random seed for sampling (for reproducibility make sure the seed is set to 5 before running the   sampling line)
  set.seed(5)
  
  # taking a random sample of of 30% of the data
  sample <- sample.split(data_set, SplitRatio = percentage)
  # make a training set and a test set using the defined sample
  train <- subset(data_set, sample = FALSE)     # set the training set (70%)
  test  <- subset(data_set, sample = TRUE)      # set the test set     (30%)
```

### Partial least squares regression

```{r pls}
  # load required package
  library(pls)
  
  # build the pls model using plsr function 
  pls_model <- plsr(r$bp ~ ., data = train, validation = "CV")
  plot(pls_model$residuals)
  summary(pls_model)
```
